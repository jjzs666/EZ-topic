(self.webpackChunklms=self.webpackChunklms||[]).push([[32684],{543637:(t,e,i)=>{"use strict";i.r(e);i(892222),i(969826),i(682772),i(583710),i(974916),i(323123);const s=i.p+"ba821b6280680fdc453469588f3b4710.js";var n=i(708468),r=i(904072);function a(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=function(t,e){if(!t)return;if("string"==typeof t)return c(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);"Object"===i&&t.constructor&&(i=t.constructor.name);if("Map"===i||"Set"===i)return Array.from(t);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return c(t,e)}(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,o=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){o=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(o)throw r}}}}function c(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}var o=function(t){for(var e=t.target;e&&e.tagName&&"A"!==e.tagName;){if("BODY"===e.tagName)return;e=e.parentNode}var i=window.gaSettings.pageName,s=function(t){for(var e=window.gaSettings.pageAreaMap;t&&t.tagName&&"BODY"!==t.tagName;){if("DIV"===t.tagName){var i,s=a(t.className.split(" "));try{for(s.s();!(i=s.n()).done;){var n=i.value;if(void 0!==e[n])return e[n]}}catch(t){s.e(t)}finally{s.f()}}t=t.parentNode}return"unknown"}(e);return t.data&&t.data.tracker?ga("".concat(t.data.tracker,".send"),"event","PageArea","click","".concat(i,"-").concat(s)):ga("send","event","PageArea","click","".concat(i,"-").concat(s))},u=function(t,e){if(e){if(ga("create",t,"auto",e),window.analyticsData){var i="".concat(e,".set");ga(i,"dimension1",window.analyticsData.orgName),ga(i,"dimension2","".concat(window.analyticsData.userId,"-").concat(window.analyticsData.userName))}return ga("".concat(e,".send"),"pageview"),r((function(){if(window.gaSettings)return r("body").on("click",{tracker:e},o)}))}return ga("create",t,"auto"),window.analyticsData&&(ga("set","dimension1",window.analyticsData.orgName),ga("set","dimension2","".concat(window.analyticsData.userId,"-").concat(window.analyticsData.userName))),ga("send","pageview"),r((function(){if(window.gaSettings)return r("body").on("click",o)}))};!function(){var t,e,i,r,a,c,o,h;if(e=window,i=document,r="script",a=s,c="ga",e.GoogleAnalyticsObject=c,e.ga=e.ga||function(){return(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=i.createElement(r),h=i.getElementsByTagName(r)[0],o.async=1,o.src=a,h.parentNode.insertBefore(o,h),null!=window.statisticsSettings?window.statisticsSettings.gaTrackingId:void 0)t=window.statisticsSettings.gaTrackingId;else{var v=n.find([{domain:/.*tronclass\.com\.cn$/,ua:"UA-59224628-6"},{domain:/lms\.eurasia\.edu/,ua:"UA-59224628-5"},{domain:/class\.xjtu\.edu\.cn/,ua:"UA-59224628-7"},{domain:/.*k12\.tronclass\.com/,ua:"UA-59224628-9"},{domain:/www\.ahmooc\.cn/,ua:"UA-59224628-12"},{domain:/lms\.bnu\.edu\.cn/,ua:"UA-59224628-13"},{domain:/lms\.sgjx\.com\.cn/,ua:"UA-59224628-14"},{domain:/wlyx\.21shte\.net/,ua:"UA-59224628-15"},{domain:/dev\.tronclass\.com/,ua:"UA-59224628-25"},{domain:/lms\.csu\.edu\.cn/,ua:"UA-59224628-34"},{domain:/lonelyreader\.com/,ua:"UA-59224628-38"}],(function(t){return t.domain.test(document.domain)}));if(!v)return;t=v.ua}if(t.indexOf(",")>0){var d=t.split(",");return function(){for(var t=[],e=0;e<d.length;e++){var i=d[e],s="tracker".concat(e);t.push(u(i,s))}return t}()}u(t)}()},636335:(t,e,i)=>{var s=i(963764);i(241539),i(788674),i(932564);var n=i(887757);function r(t,e,i,s,n,r,a){try{var c=t[r](a),o=c.value}catch(t){return void i(t)}c.done?e(o):Promise.resolve(o).then(s,n)}i(535666);var a=function(){var t=document.body.getAttribute("-ng-app");window.__ANGULAR_APP_NAME__=null!=t?t:"",window.__ANGULAR_APP_SPA__="app"===t};t.exports={bootNgApp:function(){var t=document.body.getAttribute("-ng-app");setTimeout((function(){a(),s.bootstrap(document.body,[t],{strictDi:!0})}))},bootNgAppOnDemand:function(){return(t=n.mark((function t(){var e;return n.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e=document.body.getAttribute("-ng-app")){t.next=3;break}return t.abrupt("return");case 3:if("common"===e){t.next=6;break}return t.next=6,i(551317)("./".concat(e));case 6:setTimeout((function(){a(),s.bootstrap(document.body,[e],{strictDi:!0})}));case 7:case"end":return t.stop()}}),t)})),function(){var e=this,i=arguments;return new Promise((function(s,n){var a=t.apply(e,i);function c(t){r(a,s,n,c,o,"next",t)}function o(t){r(a,s,n,c,o,"throw",t)}c(void 0)}))})();var t},JSLoad:function(){document.body.style.visibility="visible"}}},595221:(t,e,i)=>{var s=i(370538).default,n=i(904072),r=i(708468);i(605212),i(968309),s.directive("tipsy",{inserted:function(t,e,i){return n(t).tipsy({ellipsis:!0,opacity:.95,gravity:"sw",html:!0})}}),s.directive("click-outside-el",{bind:function(t,e,i){var s;if("function"!=typeof e.value){var n=i.context.name,a="[Vue-click-outside:] provided expression '".concat(e.expression,"' is not a function, but has to be");n&&(a+="Found in component '".concat(n,"'")),console.warn(a)}var c=e.modifiers.bubble,o=e.arg;o&&(s=document.querySelectorAll(".".concat(o)));document.querySelector("[disable-click-outside]");var u=function(i){var n=event.target||event.srcElement;n.getAttribute&&"true"===n.getAttribute("disable-click-outside")||s&&r.some(s,(function(t){return t.contains(i.target)}))||(c||!t.contains(i.target)&&t!==i.target)&&e.value(i)};return t.__vueClickOutside__=u,document.addEventListener("mousedown",u)},unbind:function(t,e){document.removeEventListener("mousedown",t.__vueClickOutside__),t.__vueClickOutside__=null}})},684266:(t,e,i)=>{var s=i(370538).default;i(57327);var n=i(635224);s.filter("datetime",n.datetime())},718652:(t,e,i)=>{"use strict";i.r(e);i(968309),i(241539),i(788674);var s=i(370538),n=i(866473),r=i.n(n),a=i(709564),c=i(593560),o=i(188465),u=i(285256),h=i(74104),v=i(507710),d=i(409669),l=i.n(d);window.Vue=s.default,"$url"in s.default.prototype||s.default.use(h.ZP),s.default.use(r()),i(595221),i(684266),s.default.use(i(509429).Z),s.default.use(u.Z),s.default.customElement(a.Z.name,a.Z),s.default.customElement(c.Z.name,c.Z),s.default.customElement(o.Z.name,o.Z),s.default.customElement("chat-robot",i(77732).Z),Promise.all([i.e(67728),i.e(19440),i.e(74632),i.e(66500)]).then(i.bind(i,66500)).then((function(t){t.default.i18n=v.Z,s.default.customElement("ono-stat-students",t.default)})),s.default.config.productionTip=!1,l().interceptors.request.use((function(t){var e=/^\/api\//.test(t.url);return window.RequestScope&&e&&(t.headers["Request-Scope"]=window.RequestScope),t}))},255178:(t,e,i)=>{"use strict";i.r(e);var s=i(74104),n=i(370538),r=i(904072);"$url"in n.default.prototype||n.default.use(s.ZP),r("#notification_container").length&&new n.default({el:"#notification_container",data:{},components:{"notification-container":i(711816).Z}})},421169:(t,e,i)=>{var s;null!==(s=window.CONFIGS)&&void 0!==s&&s.assetsPath&&(i.p=window.CONFIGS.assetsPath)},356230:(t,e,i)=>{var s=i(708468),n=i(904072),r=i(293789),a=i(730381);function c(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){if("undefined"==typeof Symbol||!(Symbol.iterator in Object(t)))return;var i=[],s=!0,n=!1,r=void 0;try{for(var a,c=t[Symbol.iterator]();!(s=(a=c.next()).done)&&(i.push(a.value),!e||i.length!==e);s=!0);}catch(t){n=!0,r=t}finally{try{s||null==c.return||c.return()}finally{if(n)throw r}}return i}(t,e)||u(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function o(t,e){var i;if("undefined"==typeof Symbol||null==t[Symbol.iterator]){if(Array.isArray(t)||(i=u(t))||e&&t&&"number"==typeof t.length){i&&(t=i);var s=0,n=function(){};return{s:n,n:function(){return s>=t.length?{done:!0}:{done:!1,value:t[s++]}},e:function(t){throw t},f:n}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var r,a=!0,c=!1;return{s:function(){i=t[Symbol.iterator]()},n:function(){var t=i.next();return a=t.done,t},e:function(t){c=!0,r=t},f:function(){try{a||null==i.return||i.return()}finally{if(c)throw r}}}}function u(t,e){if(t){if("string"==typeof t)return h(t,e);var i=Object.prototype.toString.call(t).slice(8,-1);return"Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i?Array.from(t):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?h(t,e):void 0}}function h(t,e){(null==e||e>t.length)&&(e=t.length);for(var i=0,s=new Array(e);i<e;i++)s[i]=t[i];return s}function v(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}i(892222),i(57327),i(969826),i(489554),i(491038),i(682772),i(569600),i(821249),i(747042),i(583710),i(369070),i(974916),i(978783),i(323123),i(454747);var d=function(){"use strict";function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.url=e.server,this.enableMgsQueryCache=e.enableMgsQueryCache,this.videoViewsCache={},this.videosPlayedCache={},this.videoViewsOfOrgCache={},this.videoStatofOrgCache={},this.courseVideosPlayedCache={},this.courseLessonsPlayedCache={},this.lessonViewsCache={},this.lessonsPlayedCache={},this.courseStudentVisitsCache={},this.courseStudentOnlineVideosCache={},this.courseActivityTypeStudentVisitsCache={},this.countInCourseCache={},this.countInCourseWithParamsCache={},this.departmentVisitsDaysCache={},this.departmentVisitsCache={},this.departmentVisitsTodayCache={},this.departmentVisitsYearCache={},this.courseVisitsDaysCache={},this.courseVisitsCache={},this.courseVisitsTodayCache={},this.courseVisitsYearCache={},this.userCourseVideosVisitsCache={},this.userCourseVisitsCache={},this.userCourseVisitsDaysCache={},this.userCourseVisitsTodayCache={},this.userCourseVisitsYearCache={},this.studentCourseVisitDetailsCache={},this.userCourseActivitiesVisitsDaysCache={},this.userCourseActivitiesVisitsTodayCache={},this.userCourseActivitiesVisitsYearCache={},this.courseActivitiesVisitsDaysCache={},this.courseActivitiesVisitsTodayCache={},this.courseActivitiesVisitsYearCache={},this.activitiesVisitCache={},this.activityVisitCache={},this.studentActivityVisitCache={},this.studentWebLinkViewCache={},this.studentVideoViewCache={},this.studentLessonViewCache={},this.studentMaterialDownloadCache={},this.userMaterialDownloadsCache={},this.courseMaterialDownloadCache={},this.courseWebLinkViewCache={},this.orgVisitsCache={},this.orgVisitsDateRangeCache={},this.orgVisitsDaysCache={},this.orgVisitsTodayCache={},this.orgVisitsYearCache={},this.orgVisitsByBrowserCache={},this.orgVisitsByDateRangeBrowserCache={},this.bulletinVisitsCache={},this.bulletinVisitsDateRangeCache={},this.bulletinVisitsDaysCache={},this.bulletinVisitsTodayCache={},this.bulletinVisitsYearCache={},this.bulletinVisitsStatCache={}}var e,i,u;return e=t,(i=[{key:"_extractResource",value:function(t,e,i){return s.each(e,(function(e){var s=e.user_id,n=e.activity_id;if(null==t[s]&&(t[s]={}),null==t[s][i]&&(t[s][i]={}),null==t[s][i][n]&&(t[s][i][n]={}),"material"===i){var r=e.upload_id;t[s][i][n][r]=(e.data.download_count||0)+(e.data.view_count||0)}else t[s][i][n]=e.data.view_count||0}))}},{key:"countInCourseWithParams",value:function(t,e,i,s,r){var a=JSON.stringify(i),c="".concat(a).concat(t);c in this.countInCourseWithParamsCache&&s(this.countInCourseWithParamsCache[c]);var o=this._build_query("courses/".concat(t,"/activities/metrics?types=").concat(a),!1,e);return n.when(o).then((function(t){s(t)}),r)}},{key:"countInCourse",value:function(t,e){var i=this;if(!(t in this.countInCourseCache)){var s=this._query("courses/".concat(t,"/activities/metrics?types=").concat(JSON.stringify({material:["user","activity","upload"],web_link:["user","activity"],slide:["user","activity"],lesson:["user","activity"],online_video:["user","activity"]})));return n.when(s).then((function(s){var n={};for(var r in s){var a=s[r];i._extractResource(n,a,r)}return i.countInCourseCache[t]=n,e(n)}),(function(){return e({})}))}e(this.countInCourseCache[t])}},{key:"countInCourseWithStudentIds",value:function(t,e,i){var s=this,r=this._query("courses/".concat(t,"/activities/metrics?user_ids=").concat(e,"&types=").concat(JSON.stringify({material:["user","activity","upload"],web_link:["user","activity"],slide:["user","activity"],lesson:["user","activity"],online_video:["user","activity"]})));return n.when(r).then((function(t){var e={};for(var n in t){var r=t[n];s._extractResource(e,r,n)}return i(e)}),(function(){return i({})}))}},{key:"videoViews",value:function(t,e){return this._videoViews(t,e,"online-videos",this.videoViewsCache)}},{key:"interactionVideoViews",value:function(t,e){return this._videoViews(t,e,"interactions",this.videoViewsCache)}},{key:"lessonViews",value:function(t,e){return this._videoViews(t,e,"lessons",this.lessonViewsCache)}},{key:"_videoViews",value:function(t,e,i,s){var r="".concat(t,"_").concat(i);if(!(r in s)){var a=this._query("activities/".concat(t,"/").concat(i,"/metrics?group_by=user"));return n.when(a).then((function(t){var i={};return t.forEach((function(t){return i[t.user_id]={firstView:t.data.first_view,lastView:t.data.last_view,viewDuration:t.data.play_duration||0,views:t.data.view_count||0}})),s[r]=i,e(i)}),(function(){return e({})}))}e(s[r])}},{key:"videosViewedOfOrg",value:function(t,e){var i=this;if(!(t in this.videoViewsOfOrgCache)){var s=this._query("orgs/".concat(t,"/online-videos/metrics?time_restrict=day"));return n.when(s).then((function(s){var n={views_today:0,views_this_month:0},r=s[s.length-1];return n.views_today=r.view_count||0,n.views_this_month=0,s.forEach((function(t){return n.views_this_month+=t.view_count||0})),i.videoViewsOfOrgCache[t]=n,e(n)}),(function(){return e({})}))}e(this.videoViewsOfOrgCache[t])}},{key:"videoStatOrg",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.videoStatofOrgCache)){var r=this._query("orgs/".concat(t,"/online-videos/stat?range=").concat(e));return n.when(r).then((function(t){return i(t)}),(function(){return i({})}))}i(this.videoStatofOrgCache[s])}},{key:"videosPlayed",value:function(t,e,i){return this._videosPlayed(t,e,i,"online-videos",this.videosPlayedCache)}},{key:"courseVideosPlayed",value:function(t,e,i){return this._courseVideosPlayed(t,e,i,"online-videos",this.courseVideosPlayedCache)}},{key:"interactionVideosPlayed",value:function(t,e,i){return this._videosPlayed(t,e,i,"interactions",this.videosPlayedCache)}},{key:"courseInteractionVideosPlayed",value:function(t,e,i){return this._courseVideosPlayed(t,e,i,"interactions",this.courseVideosPlayedCache)}},{key:"lessonsPlayed",value:function(t,e,i){return this._courseVideosPlayed(t,e,i,"lessons",this.lessonsPlayedCache)}},{key:"courseLessonsPlayed",value:function(t,e,i){return this._courseVideosPlayed(t,e,i,"lessons",this.courseLessonsPlayedCache)}},{key:"_courseVideosPlayed",value:function(t,e,i,s,r){var a="".concat(t,"_").concat(s);if(!(a in r)){var c=this._build_query("courses/".concat(t,"/").concat(s,"/metrics?group_by=course,activity"),!1,e);return n.when(c).then((function(t){var e={};return t.forEach((function(t){e[t.activity_id]=t.data})),r[a]=e,i(e)}),(function(){return i({})}))}i(r[a])}},{key:"_videosPlayed",value:function(t,e,i,s){var r="".concat(t,"_").concat(i);if(!(r in s)){var a=this._query("courses/".concat(t,"/").concat(i,"/metrics?group_by=user,activity"));return n.when(a).then((function(t){var i={};return t.forEach((function(t){return null==i[t.activity_id]&&(i[t.activity_id]={}),i[t.activity_id][t.user_id]={views:t.data.view_count||0,viewDuration:t.data.play_duration||0}})),s[r]=i,e(i)}),(function(){return e({})}))}e(s[r])}},{key:"courseVideosViewsCustomRange",value:function(t,e,i,s,r){var a=(new Date).getTimezoneOffset()/-60,c=this._query("courses/".concat(t,"/online-videos/plays?start=").concat(e,"&end=").concat(i,"&timezone_offset=").concat(a,"&split=").concat(s)),u=this._query("courses/".concat(t,"/interactions/plays?start=").concat(e,"&end=").concat(i,"&timezone_offset=").concat(a,"&split=").concat(s));return n.when(c,u).then((function(t,e){var i,s="success"===t[1]?t[0]:[],n="success"===e[1]?e[0]:[],a={},c=o(s.concat(n));try{for(c.s();!(i=c.n()).done;){var u=i.value;a[u.activity_id]=u.plays}}catch(t){c.e(t)}finally{c.f()}return r(a)}),(function(t){return r({})}))}},{key:"courseVideosViews",value:function(t,e,i,s){var a={day:"hour",week:"day",month:"day",year:"month"},c=this._query("courses/".concat(t,"/online-videos/metrics?group_by=activity,user&time_restrict=").concat(a[e])),u=this._query("courses/".concat(t,"/interactions/metrics?group_by=activity,user&time_restrict=").concat(a[e]));return n.when(c,u).then((function(t,n){var a,c="success"===t[1]?t[0]:[],u="success"===n[1]?n[0]:[],h={},v=o(c.concat(u));try{for(v.s();!(a=v.n()).done;){var d=a.value;if(-1===i.indexOf(d.user_id)){var l,y=[],f=o(d.data);try{for(f.s();!(l=f.n()).done;){var _=l.value,m="play_count"in _?_.play_count:0;y.push(m)}}catch(t){f.e(t)}finally{f.f()}if("week"===e&&(y=y.slice(-7)),d.activity_id in h){var V,C=o(r.range(0,h[d.activity_id].length-1,!0));try{for(C.s();!(V=C.n()).done;){var w=V.value;h[d.activity_id][w]+=y[w]}}catch(t){C.e(t)}finally{C.f()}}else h[d.activity_id]=y}}}catch(t){v.e(t)}finally{v.f()}return s(h)}),(function(){return s({})}))}},{key:"courseStudentOnlineVideos",value:function(t,e){var i=this;if(!(t in this.courseStudentOnlineVideosCache)){var s=this._query("courses/".concat(t,"/online-videos/metrics?group_by=activity,user"));return n.when(s).then((function(s){var n={};return s.forEach((function(t){t.data.play_duration&&t.data.play_duration<0&&(t.data.play_duration=0),n[t.user_id]?(n[t.user_id].playCount+=t.data.play_count||0,n[t.user_id].playDuration+=t.data.play_duration||0):n[t.user_id]={playCount:t.data.play_count||0,playDuration:t.data.play_duration||0}})),i.courseStudentOnlineVideosCache[t]=n,e(n)}),(function(){return e({})}))}e(this.courseStudentOnlineVideosCache[t])}},{key:"courseStudentOnlineVideosWithStudentIds",value:function(t,e,i){var s=this._query("courses/".concat(t,"/online-videos/metrics?user_ids=").concat(e,"&group_by=activity,user"));return n.when(s).then((function(t){var e={};return t.forEach((function(t){e[t.user_id]?(e[t.user_id].playCount+=t.data.play_count||0,e[t.user_id].playDuration+=t.data.play_duration||0):e[t.user_id]={playCount:t.data.play_count||0,playDuration:t.data.play_duration||0}})),i(e)}),(function(){return i({})}))}},{key:"videoStudentsInterval",value:function(t,e,i,s,r,a,c){var u="video/".concat(t,"/online-videos/users/intervals?range=").concat(e);if("custom"===e){var h=(new Date).getTimezoneOffset()/-60;u+="&start=".concat(a,"&end=").concat(c,"&timezone_offset=").concat(h)}var v=this._build_query(u,!1,i);return n.when(v).then((function(t){var e,i={},n=o(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;i[r._id]=r.intervals}}catch(t){n.e(t)}finally{n.f()}return s(i)}),(function(t){return r(t.responseJSON)}))}},{key:"lessonStudentsInterval",value:function(t,e,i,s,r,a){var c;if("custom"===e){var u=(new Date).getTimezoneOffset()/-60;c=this._query("video/".concat(t,"/lessons/users/intervals?range=").concat(e,"&start=").concat(r,"&end=").concat(a,"&timezone_offset=").concat(u))}else c=this._query("video/".concat(t,"/lessons/users/intervals?range=").concat(e));return n.when(c).then((function(t){var e,s={},n=o(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;s[r._id]=r.intervals}}catch(t){n.e(t)}finally{n.f()}return i(s)}),(function(t){return s(t.responseJSON)}))}},{key:"interactionVideoStudentsInterval",value:function(t,e,i,s,r,a){var c;if("custom"===e){var u=(new Date).getTimezoneOffset()/-60;c=this._query("video/".concat(t,"/interactions/users/intervals?range=").concat(e,"&start=").concat(r,"&end=").concat(a,"&timezone_offset=").concat(u))}else c=this._query("video/".concat(t,"/interactions/users/intervals?range=").concat(e));return n.when(c).then((function(t){var e,s={},n=o(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;s[r._id]=r.intervals}}catch(t){n.e(t)}finally{n.f()}return i(s)}),(function(t){return s(t.responseJSON)}))}},{key:"courseStudentVisits",value:function(t,e){var i=this;if(!(t in this.courseStudentVisitsCache)){var s=this._query("courses/".concat(t,"/user-visits/metrics?group_by=user"));return n.when(s).then((function(s){var n={};return s.forEach((function(t){return n[t.user_id]={visits:t.data.count||0,visitDuration:t.data.sum||0,firstVisit:t.data.first_time,lastVisit:t.data.last_time}})),i.courseStudentVisitsCache[t]=n,e(n)}),(function(){return e({})}))}e(this.courseStudentVisitsCache[t])}},{key:"courseStudentVisitsWithStudentIds",value:function(t,e,i){var s=this._query("courses/".concat(t,"/user-visits/metrics?user_ids=").concat(e,"&group_by=user"));return n.when(s).then((function(t){var e={};return t.forEach((function(t){return e[t.user_id]={visits:t.data.count||0,visitDuration:t.data.sum||0,firstVisit:t.data.first_time,lastVisit:t.data.last_time}})),i(e)}),(function(){return i({})}))}},{key:"courseVideosStudentViews",value:function(t,e,i){return this._courseVideosStudentViews(t,e,i,"online-videos",this.studentVideoViewCache)}},{key:"courseLessonsStudentViews",value:function(t,e,i){return this._courseVideosStudentViews(t,e,i,"lessons",this.studentLessonViewCache)}},{key:"_courseVideosStudentViews",value:function(t,e,i,s,r){var a="".concat(t,"_").concat(e);if(!r[a]){var c=this._query("courses/".concat(t,"/users/").concat(e,"/").concat(s,"/metrics?group_by=activity"));return n.when(c).then((function(t){var e={};return t.forEach((function(t){return e[t.activity_id]={firstView:t.data.first_view,lastView:t.data.last_view,views:t.data.view_count||0,viewDuration:t.data.play_duration||0}})),r[a]=e,i(e)}),(function(){return i({})}))}i(r[a])}},{key:"courseMaterialsStudentDownloads",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!this.studentMaterialDownloadCache[r]){var a=this._query("courses/".concat(t,"/users/").concat(e,"/materials/metrics?group_by=activity,upload"));return n.when(a).then((function(t){var e={};return t.forEach((function(t){var i="".concat(t.activity_id,"_").concat(t.upload_id);return e[i]={downloads:t.data.download_count||0,views:t.data.view_count||0,lastDownload:t.data.last_download,lastView:t.data.last_view}})),s.studentMaterialDownloadCache[r]=e,i(e)}),(function(){return i({})}))}i(this.studentMaterialDownloadCache[r])}},{key:"courseMaterialsDownloads",value:function(t,e,i){var s=this;if(!this.courseMaterialDownloadCache[t]){var r=this._build_query("courses/".concat(t,"/materials/metrics?group_by=activity,upload,user"),!1,e);return n.when(r).then((function(e){var n={};return e.forEach((function(t){var e="".concat(t.activity_id,"_").concat(t.upload_id);return null==n[e]&&(n[e]={}),n[e][t.user_id]={downloads:t.data.download_count||0,lastDownload:t.data.last_download,views:t.data.view_count||0,lastView:t.data.last_view}})),s.courseMaterialDownloadCache[t]=n,i(n)}),(function(){return i({})}))}i(this.courseMaterialDownloadCache[t])}},{key:"courseWebLinkStudentViews",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!this.studentWebLinkViewCache[r]){var a=this._query("courses/".concat(t,"/users/").concat(e,"/weblinks/metrics?group_by=activity"));return n.when(a).then((function(t){var e={};return t.forEach((function(t){return e[t.activity_id]={views:t.data.view_count||0,lastView:t.data.last_view}})),s.studentWebLinkViewCache[r]=e,i(e)}),(function(){return i({})}))}i(this.studentWebLinkViewCache[r])}},{key:"courseWebLinkViews",value:function(t,e,i){var s=this;if(!this.courseWebLinkViewCache[t]){var r=this._build_query("courses/".concat(t,"/weblinks/metrics?group_by=activity,user"),!1,e);return n.when(r).then((function(e){var n={};return e.forEach((function(t){return null==n[t.activity_id]&&(n[t.activity_id]={}),n[t.activity_id][t.user_id]={views:t.data.view_count||0,lastView:t.data.last_view}})),s.courseWebLinkViewCache[t]=n,i(n)}),(function(){return i({})}))}i(this.courseWebLinkViewCache[t])}},{key:"studentCourseVisits",value:function(t,e,i){var s=this,r="".concat(e,"_").concat(t);if(!this.studentCourseVisitDetailsCache[r]){var a=this._query("courses/".concat(e,"/users/").concat(t,"/user-visits"));return n.when(a).then((function(t){var e=[];return t.forEach((function(t){var i={activityId:null==t.activity_id?"":t.activity_id,activityType:t.activity_type||null,groupId:t.group_id,visitTime:t.time,visitDuration:t.visit_duration};return e.push(i)})),s.studentCourseVisitDetailsCache[r]=e,i(e)}),(function(){return i({})}))}i(this.studentCourseVisitDetailsCache[r])}},{key:"courseActivitiesStudentVisits",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!this.studentActivityVisitCache[r]){var a=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?group_by=activity,group,type"));return n.when(a).then((function(t){var e={};return t.forEach((function(t){var i="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(i+="_".concat(t.group_id)),e[i]={firstVisit:t.data.first_time,lastVisit:t.data.last_time,visits:t.data.count||0,visitDuration:t.data.sum||0,type:t.activity_type}})),s.studentActivityVisitCache[r]=e,i(e)}),(function(){return i({})}))}i(this.studentActivityVisitCache[r])}},{key:"courseStudentActivityTypeVisits",value:function(t,e,i,s){var r="course"===e?"user":"user,type";"course"===e&&(e="");var a=this._query("courses/".concat(t,"/user-visits/metrics?user_ids=").concat(i,"&activity_type=").concat(e,"&group_by=").concat(r));return n.when(a).then((function(t){var e={};return t.forEach((function(t){return e[t.user_id]={firstVisit:t.data.first_time,lastVisit:t.data.last_time,visits:t.data.count||0,visitDuration:t.data.sum||0,type:t.activity_type}})),s(e)}),(function(){return s({})}))}},{key:"courseVisitsStat",value:function(t,e,i,s,r,c){var o=this;"course"===e&&(e="");var u=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=").concat(s,"&activity_type=").concat(e),!1,r);return n.when(u).then((function(t){var e,n,r;"month"===s&&(n=a(a().format("YYYY-MM-DD"))),"month"===s&&(e=n.clone().add(-11,"months"));var u=o._emptyDay(),h=o._emptyDay();return"hour"===s?r=t:"day"===s?r=t.slice(t.length-i,t.length+1):"month"===s&&(r=o._filterVisitsByDate(t,e,n)),r.forEach((function(t,e){return u[e]=t.student_count||0})),r.forEach((function(t,e){return h[e]=t.student_distinct||0})),c({visits:u,visitors:h})}),(function(){return c({})}))}},{key:"usersCourseActivityTypeVisits",value:function(t,e,i,s,r,c){var u=this;"course"===r&&(r="");var h=this._query("courses/".concat(t,"/user-visits/metrics?time_restrict=").concat(s,"&user_ids=").concat(e,"&activity_type=").concat(r,"&group_by=user"));return n.when(h).then((function(t){var e,n;"month"===s&&(n=a(a().format("YYYY-MM-DD"))),"month"===s&&(e=n.clone().add(-11,"months"));var r,h={},v=o(t);try{for(v.s();!(r=v.n()).done;){var d=r.value,l=[];if("hour"===s)l=d.data;else if("day"===s){h[d.user_id]=u._emptyDays(i);var y=d.data.length;l=d.data.slice(y-i,y+1)}else"month"===s&&(l=u._filterVisitsByDate(d.data,e,n));h[d.user_id]=l.map((function(t,e){return t.student_count||0}))}}catch(t){v.e(t)}finally{v.f()}return c(h)}),(function(){return c([])}))}},{key:"courseActivitiesVisits",value:function(t,e,i,s){var r=this;if(!this.activitiesVisitCache[t]){var a=e?"student_":"",c=this._build_query("courses/".concat(t,"/user-visits/metrics?group_by=activity,group,type"),!1,i);return n.when(c).then((function(e){var i={};return e.forEach((function(t){var e="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(e+="_".concat(t.group_id)),i[e]={visits:t.data["".concat(a,"count")]||0}})),r.activitiesVisitCache[t]=i,s(i)}),(function(){return s({})}))}s(this.activitiesVisitCache[t])}},{key:"activityVisits",value:function(t,e,i,r,a){var o,u=this,h="".concat(i,"_").concat(e,"_").concat(t);if(!this.activityVisitCache[h]){if(s.contains(e,"_")){var v=c(Array.from(e.split("_")),2);e=v[0],o=v[1]}else o="null";var d=this._build_query("courses/".concat(t,"/activities/").concat(e,"/activity-types/").concat(i,"/user-visits/metrics?group=").concat(o,"&group_by=user"),!1,r);return n.when(d).then((function(t){var e={};return t.forEach((function(t){return e[t.user_id]={lastVisit:t.data.last_time,visits:t.data.count||0}})),u.activityVisitCache[h]=e,a(e)}),(function(){return a({})}))}a(this.activityVisitCache[h])}},{key:"userCourseVisits",value:function(t,e,i){var s=this,r="".concat(e,"_").concat(t);if(!this.userCourseVisitsCache[r]){var a=this._query("courses/".concat(e,"/users/").concat(t,"/user-visits/metrics"));return n.when(a).then((function(t){var e={visits:t.count||0,visitDuration:t.sum||0};return s.userCourseVisitsCache[r]=e,i(e)}),(function(){return i({})}))}i(this.userCourseVisitsCache[r])}},{key:"userCourseVideosVisits",value:function(t,e,i){var s=this,r="".concat(e,"_").concat(t);if(!this.userCourseVideosVisitsCache[r]){var a=this._query("courses/".concat(e,"/users/").concat(t,"/online-videos/metrics?group_by=activity")),c=this._query("courses/".concat(e,"/users/").concat(t,"/interactions/metrics?group_by=activity"));return n.when(a,c).then((function(t,e){var n,a={viewCount:0,playCount:0,playDuration:0},c="success"===t[1]?t[0]:[],u="success"===e[1]?e[0]:[],h=o(c.concat(u));try{for(h.s();!(n=h.n()).done;){var v=n.value;v.data&&(a.viewCount+=v.data.view_count||0,a.playCount+=v.data.play_count||0,(null!=v.data.play_duration)>0&&(a.playDuration+=v.data.play_duration))}}catch(t){h.e(t)}finally{h.f()}return s.userCourseVideosVisitsCache[r]=a,i(a)}),(function(){return i({})}))}i(this.userCourseVideosVisitsCache[r])}},{key:"userMaterialDownloads",value:function(t,e,i){var s=this,r="".concat(e,"_").concat(t);if(!this.userMaterialDownloadsCache[r]){var a=this._query("courses/".concat(e,"/users/").concat(t,"/materials/metrics"));return n.when(a).then((function(t){var e={downloads:(t.download_count||0)+(t.view_count||0)};return s.userMaterialDownloadsCache[r]=e,i(e)}),(function(){return i({})}))}i(this.userMaterialDownloadsCache[r])}},{key:"_onVisitsQuerySuccess",value:function(t,e,i,s){return function(n){var r=n[e]||0;return t[i]=r,s(r)}}},{key:"_onVisitsDaysQuerySuccess",value:function(t,e,i,s,n){var r=this;return function(a){var c={visits:r._emptyDays(i),visitors:r._emptyDays(i)};return(a=a.slice(a.length-i,a.length+1)).forEach((function(t,e){return c.visits[e]=t["".concat(s,"count")]||0,c.visitors[e]=t["".concat(s,"distinct")]||0})),t[e]=c,n(c)}}},{key:"_filterVisitsByDate",value:function(t,e,i){var s,n=[];if(this._isVisitsByMonth(t)){for(var r=e.get("year"),c=e.get("month")+1,o=i.get("year"),u=i.get("month")+1;r<=o;){for(var h=r<o?12:u;c<=h;)s=a().year(r).month(c-1).date(1).hour(0).minute(0).format("YYYY/MM/DD HH:mm"),n.push(this._filterVisitByTime(t,s)),c+=1;c=1,r+=1}return n}for(var v=e;i.diff(v,"days")>=0;)s=v.format("YYYY/MM/DD HH:mm"),n.push(this._filterVisitByTime(t,s)),v.add(1,"days");return n}},{key:"_filterVisitByTime",value:function(t,e){var i=s.filter(t,(function(t){return t.time===e}));return 1===i.length?i[0]:s.find(i,(function(t){return void 0!==t.count}))||{count:0,distinct:0}}},{key:"_isVisitsByMonth",value:function(t){if(t.length<2)return!1;var e=a(t[0].time,"YYYY/MM/DD HH:mm");return 27<a(t[1].time,"YYYY/MM/DD HH:mm").diff(e,"days")}},{key:"_onVisitsTodayQuerySuccess",value:function(t,e,i,s){var n=this;return function(r){var a={visits:n._emptyDay(),visitors:n._emptyDay()};return r.forEach((function(t,e){return a.visits[e]=t["".concat(i,"count")]||0,a.visitors[e]=t["".concat(i,"distinct")]||0})),t[e]=a,s(a)}}},{key:"_onVisitsYearQuerySuccess",value:function(t,e,i,s){var n=this;return function(r){var c={visits:n._emptyYear(),visitors:n._emptyYear()},o=a(a().format("YYYY-MM-DD")),u=o.clone().add(-11,"months");return(r=n._filterVisitsByDate(r,u,o)).forEach((function(t,e){return c.visits[e]=t["".concat(i,"count")]||0,c.visitors[e]=t["".concat(i,"distinct")]||0})),t[e]=c,s(c)}}},{key:"_emptyYear",value:function(){var t=(new Date).getMonth()+1;return s.map(r.range(1,t,!0),(function(){return 0}))}},{key:"_emptyDays",value:function(t){return s.map(r.range(1,t,!0),(function(){return 0}))}},{key:"_emptyDay",value:function(){var t=(new Date).getHours()+1;return s.map(r.range(1,t,!0),(function(){return 0}))}},{key:"courseVisits",value:function(t,e,i,s){if(!(t in this.courseVisitsCache)){var r=e?"student_":"",a=this._onVisitsQuerySuccess(this.courseVisitsCache,"".concat(r,"count"),t,s),c=this._build_query("courses/".concat(t,"/user-visits/metrics"),!1,i);return n.when(c).then(a,(function(){return s(0)}))}s(this.courseVisitsCache[t])}},{key:"userCourseVisitsToday",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseVisitsTodayCache)){var r=this._onVisitsTodayQuerySuccess(this.userCourseVisitsTodayCache,s,"",(function(t){return i(t.visits||[])})),a=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=hour"));return n.when(a).then(r,(function(){return i({})}))}i(this.userCourseVisitsTodayCache[s].visits)}},{key:"courseVisitsToday",value:function(t,e,i,s){if(!(t in this.courseVisitsTodayCache)){var r=e?"student_":"",a=this._onVisitsTodayQuerySuccess(this.courseVisitsTodayCache,t,r,s),c=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=hour"),!1,i);return n.when(c).then(a,(function(){return s({})}))}s(this.courseVisitsTodayCache[t])}},{key:"_onGetCourseActivitiesVisitsDays",value:function(t,e,i,s,n){var r=this;return function(a){var c={};return a.forEach((function(t){var e="".concat(t.activity_type,"_").concat(t.activity_id);t.group_id>0&&(e+="_".concat(t.group_id)),c[e]=r._emptyDays(i);var n=t.data.length;return t.data.slice(n-i,n+1).forEach((function(t,i){return c[e][i]=t["".concat(s,"count")]||0}))})),t[e]=c,n(c)}}},{key:"courseVisitsCustomRange",value:function(t,e,i,r,a,c,o){var u=(new Date).getTimezoneOffset()/-60,h="courses/".concat(t,"/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(r,"&timezone_offset=").concat(u);a&&(h="".concat(h,"&activity_type=").concat(a));var v=this._build_query(h,!1,c);return n.when(v).then((function(t){var e={};return s.map(t,(function(t,i){return e[i]={visits:t.visits,visitors:t.visitor_ids.length}})),o(e)}),(function(){return o({})}))}},{key:"courseActivitiesVisitsCustomRange",value:function(t,e,i,s,r,a,c){var u=(new Date).getTimezoneOffset()/-60,h="courses/".concat(t,"/activities/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(u);r&&(h="".concat(h,"&activity_type=").concat(r));var v=this._build_query(h,!1,a);return n.when(v).then((function(t){var e,i={},s=o(t);try{for(s.s();!(e=s.n()).done;){var n=e.value;i[n.activity_id]=n.visits}}catch(t){s.e(t)}finally{s.f()}return c(i)}),(function(){return c({})}))}},{key:"courseUsersVisitsCustomRange",value:function(t,e,i,s,r,a,c){var u=(new Date).getTimezoneOffset()/-60,h="courses/".concat(t,"/users/user-visits/visits?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(u);r&&(h="".concat(h,"&activity_type=").concat(r));var v=this._build_query(h,!1,a);return n.when(v).then((function(t){var e,i={},s=o(t);try{for(s.s();!(e=s.n()).done;){var n=e.value;i[n.user_id]=n.visits}}catch(t){s.e(t)}finally{s.f()}return c(i)}),(function(){return c({})}))}},{key:"userCourseActivitiesVisitsDays",value:function(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.userCourseActivitiesVisitsDaysCache)){var a=this._onGetCourseActivitiesVisitsDays(this.userCourseActivitiesVisitsDaysCache,r,i,"",s),c=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?group_by=activity,group,type&time_restrict=day"));return n.when(c).then(a,(function(){return s([])}))}s(this.userCourseActivitiesVisitsDaysCache[r])}},{key:"courseActivitiesVisitsDays",value:function(t,e,i,s,r){var a="".concat(t,"_").concat(e);if(!(a in this.courseActivitiesVisitsDaysCache)){var c=i?"student_":"",o=this._onGetCourseActivitiesVisitsDays(this.courseActivitiesVisitsDaysCache,a,e,c,r),u=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=day&group_by=activity,group,type"),!1,s);return n.when(u).then(o,(function(){return r([])}))}r(this.courseActivitiesVisitsDaysCache[a])}},{key:"_onGetCourseActivitiesVisitsTodayOrYear",value:function(t,e,i,s){return function(n){var r={};return n.forEach((function(t){var e="".concat(t.activity_type,"_").concat(t.activity_id);return t.group_id>0&&(e+="_".concat(t.group_id)),r[e]=t.data.map((function(t){return t["".concat(i,"count")]||0}))})),t[e]=r,s(r)}}},{key:"userCourseActivitiesVisitsToday",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseActivitiesVisitsTodayCache)){var r=this._onGetCourseActivitiesVisitsTodayOrYear(this.userCourseActivitiesVisitsTodayCache,s,"",i),a=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=hour&group_by=activity,group,type"));return n.when(a).then(r,(function(){return i([])}))}i(this.userCourseActivitiesVisitsTodayCache[s])}},{key:"courseActivitiesVisitsToday",value:function(t,e,i,s){if(!(t in this.courseActivitiesVisitsTodayCache)){var r=e?"student_":"",a=this._onGetCourseActivitiesVisitsTodayOrYear(this.courseActivitiesVisitsTodayCache,t,r,s),c=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=hour&group_by=activity,group,type"),!1,i);return n.when(c).then(a,(function(){return s([])}))}s(this.courseActivitiesVisitsTodayCache[t])}},{key:"userCourseActivitiesVisitsYear",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.userCourseActivitiesVisitsYearCache)){var r=this._onGetCourseActivitiesVisitsTodayOrYear(this.userCourseActivitiesVisitsYearCache,s,"",i),a=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=month&group_by=activity,group,type"));return n.when(a).then(r,(function(){return i([])}))}i(this.userCourseActivitiesVisitsYearCache[s])}},{key:"courseActivitiesVisitsYear",value:function(t,e,i,s){if(!(t in this.courseActivitiesVisitsYearCache)){var r=e?"student_":"",a=this._onGetCourseActivitiesVisitsTodayOrYear(this.courseActivitiesVisitsYearCache,t,r,s),c=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=month&group_by=activity,group,type"),!1,i);return n.when(c).then(a,(function(){return s([])}))}s(this.courseActivitiesVisitsYearCache[t])}},{key:"userCourseVisitsDays",value:function(t,e,i,s){var r="".concat(t,"_").concat(e,"_").concat(i);if(!(r in this.userCourseVisitsDaysCache)){var a=this._onVisitsDaysQuerySuccess(this.userCourseVisitsDaysCache,r,i,"",(function(t){return s(t.visits||[])})),c=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=day"));return n.when(c).then(a,(function(){return s({})}))}s(this.userCourseVisitsDaysCache[r].visits)}},{key:"courseVisitsDays",value:function(t,e,i,s,r){var a="".concat(t,"_").concat(e);if(!(a in this.courseVisitsDaysCache)){var c=i?"student_":"",o=this._onVisitsDaysQuerySuccess(this.courseVisitsDaysCache,a,e,c,r),u=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=day"),!1,s);return n.when(u).then(o,(function(){return r({})}))}r(this.courseVisitsDaysCache[a])}},{key:"userCourseVisitsYear",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!this.userCourseVisitsYearCache[s]){var r=this._onVisitsYearQuerySuccess(this.userCourseVisitsYearCache,s,"student_",(function(t){return i(t.visits||[])})),a=this._query("courses/".concat(t,"/users/").concat(e,"/user-visits/metrics?time_restrict=month"));return n.when(a).then(r,(function(){return i({})}))}i(this.userCourseVisitsYearCache[s].visits)}},{key:"courseVisitsYear",value:function(t,e,i,s){if(!(t in this.courseVisitsYearCache)){var r=e?"student_":"",a=this._onVisitsYearQuerySuccess(this.courseVisitsYearCache,t,r,s),c=this._build_query("courses/".concat(t,"/user-visits/metrics?time_restrict=month"),!1,i);return n.when(c).then(a,(function(){return s({})}))}s(this.courseVisitsYearCache[t])}},{key:"departmentVisits",value:function(t,e){if(!(t in this.departmentVisitsCache)){var i=this._onVisitsQuerySuccess(this.departmentVisitsCache,"count",t,e),s=this._query("deps/".concat(t,"/user-visits/metrics"));return n.when(s).then(i,(function(){return e(0)}))}e(this.departmentVisitsCache[t])}},{key:"departmentVisitsDays",value:function(t,e,i){var s="".concat(t,"_").concat(e);if(!(s in this.departmentVisitsDaysCache)){var r=this._onVisitsDaysQuerySuccess(this.departmentVisitsDaysCache,s,e,"",i),a=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=day"));return n.when(a).then(r,(function(){return i({})}))}i(this.departmentVisitsDaysCache[s])}},{key:"departmentVisitsToday",value:function(t,e){if(!(t in this.departmentVisitsTodayCache)){var i=this._onVisitsTodayQuerySuccess(this.departmentVisitsTodayCache,t,"",e),s=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=hour"));return n.when(s).then(i,(function(){return e({})}))}e(this.departmentVisitsTodayCache[t])}},{key:"departmentVisitsYear",value:function(t,e){if(!(t in this.departmentVisitsYearCache)){var i=this._onVisitsYearQuerySuccess(this.departmentVisitsYearCache,t,"",e),s=this._query("deps/".concat(t,"/user-visits/metrics?time_restrict=month"));return n.when(s).then(i,(function(){return e({})}))}e(this.departmentVisitsYearCache[t])}},{key:"orgVisits",value:function(t,e){if(!(t in this.orgVisitsCache)){var i=this._onVisitsQuerySuccess(this.orgVisitsCache,"count",t,e),s=this._query("orgs/".concat(t,"/user-visits/metrics"),!0);return n.when(s).then(i,(function(){return e(0)}))}e(this.orgVisitsCache[t])}},{key:"orgVisitsDays",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!(r in this.orgVisitsDaysCache)){var c=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=day"),!0);return n.when(c).then((function(t){var n={visits:s._emptyDays(e),visitors:s._emptyDays(e)},c=a(a().format("YYYY-MM-DD")),o=c.clone().add(1-e,"days");return(t=s._filterVisitsByDate(t,o,c)).forEach((function(t,e){return n.visits[e]=t.count||0,n.visitors[e]=t.distinct||0})),s.orgVisitsDaysCache[r]=n,i(n)}),(function(){return i({})}))}i(this.orgVisitsDaysCache[r])}},{key:"orgVisitsByBrowserDays",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!(r in this.orgVisitsByBrowserCache)){var a=this._query("orgs/".concat(t,"/user-visits/browsers?days=").concat(e),!0);return n.when(a).then((function(t){return s.orgVisitsDaysCache[r]=t,i(t)}),(function(){return i(0)}))}i(this.orgVisitsByBrowserCache[r])}},{key:"orgVisitsToday",value:function(t,e){if(!(t in this.orgVisitsTodayCache)){var i=this._onVisitsTodayQuerySuccess(this.orgVisitsTodayCache,t,"",e),s=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=hour"),!0);return n.when(s).then(i,(function(){return e({})}))}e(this.orgVisitsTodayCache[t])}},{key:"orgVisitsYear",value:function(t,e){if(!(t in this.orgVisitsYearCache)){var i=this._onVisitsYearQuerySuccess(this.orgVisitsYearCache,t,"",e),s=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=month"),!0);return n.when(s).then(i,(function(){return e({})}))}e(this.orgVisitsYearCache[t])}},{key:"orgBrowserVisitsByDateRange",value:function(t,e,i,s){var r=this,a="".concat(t,"_").concat(e,"_").concat(i);if(!(a in this.orgVisitsByDateRangeBrowserCache)){var c=this._query("orgs/".concat(t,"/user-visits/date-range/browsers?start_date=").concat(e,"&end_date=").concat(i));return n.when(c).then((function(t){return r.orgVisitsDaysCache[a]=t,s(t)}),(function(){return s(0)}))}s(this.orgVisitsByDateRangeBrowserCache[a])}},{key:"orgVisitsByDateRange",value:function(t,e,i,s){var r=this,c="".concat(t,"_").concat(e,"_").concat(i);if(!(c in this.orgVisitsDateRangeCache)){var o=this._query("orgs/".concat(t,"/user-visits/metrics?time_restrict=date-range&start_date=").concat(e,"&end_date=").concat(i));return n.when(o).then((function(t){var n={visits:[],visitors:[]};return(t=r._filterVisitsByDate(t,a(e),a(i))).forEach((function(t,e){return n.visits[e]=t.count||0,n.visitors[e]=t.distinct||0})),r.orgVisitsDateRangeCache[c]=n,s(n)}),(function(){return s({})}))}s(this.orgVisitsDateRangeCache[c])}},{key:"_onBulletinVisitsQuerySuccess",value:function(t,e,i,s,n){return function(r){var a=s,c=r.length;return r.slice(c-i,c+1).forEach((function(t,e){return a[e]=t.view_count})),t[e]=a,n(a)}}},{key:"bulletinVisitsDays",value:function(t,e,i,s){var r="".concat(t,"_").concat(e);if(!(r in this.bulletinVisitsDaysCache)){var a=this._emptyDays(e),c=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsDaysCache,r,e,a,s),o=this._build_query("courses/".concat(t,"/bulletins/histogram?time_restrict=day"),!1,i);return n.when(o).then(c,(function(){return s([])}))}s(this.bulletinVisitsDaysCache[r])}},{key:"bulletinVisitsToday",value:function(t,e,i){if(!(t in this.bulletinVisitsTodayCache)){var s=this._emptyDay(),r=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsTodayCache,t,24,s,i),a=this._build_query("courses/".concat(t,"/bulletins/histogram?time_restrict=hour"),!1,e);return n.when(a).then(r,(function(){return i([])}))}i(this.bulletinVisitsTodayCache[t])}},{key:"bulletinVisitsYear",value:function(t,e,i){if(!(t in this.bulletinVisitsYearCache)){var s=this._emptyYear(),r=this._onBulletinVisitsQuerySuccess(this.bulletinVisitsYearCache,t,12,s,i),a=this._build_query("courses/".concat(t,"/bulletins/histogram?time_restrict=month"),!1,e);return n.when(a).then(r,(function(){return i([])}))}i(this.bulletinVisitsYearCache[t])}},{key:"bulletinVisitsCustomRange",value:function(t,e,i,s,r,a){var c=this,o="".concat(t,"_").concat(e,"_").concat(i);if(!(o in this.bulletinVisitsDateRangeCache)){var u=(new Date).getTimezoneOffset()/-60,h=this._build_query("courses/".concat(t,"/bulletins/custom-time-range?start=").concat(e,"&end=").concat(i,"&split=").concat(s,"&timezone_offset=").concat(u),!1,r);return n.when(h).then((function(t){return c.bulletinVisitsDateRangeCache[o]=t,a(t)}),(function(){return a([])}))}a(this.bulletinVisitsDateRangeCache[o])}},{key:"bulletinGroupByVisits",value:function(t,e,i,r){var a=this,c="".concat(t,"_").concat(e);if(!(c in this.bulletinVisitsCache)){var o=this._build_query("courses/".concat(t,"/bulletins/visit?group_by=").concat(e),!1,i);return n.when(o).then((function(t){var e={};return s.map(t,(function(t){return e[t.bulletin_id]={view_count:t.data.view_count,user_distinct:t.data.user_distinct}})),a.bulletinVisitsCache[c]=e,r(e)}),(function(){return r([])}))}r(this.bulletinVisitsCache[c])}},{key:"bulletinVisitsStat",value:function(t,e,i){var s=this,r="".concat(t,"_").concat(e);if(!(r in this.bulletinVisitsStatCache)){var a=this._query("courses/".concat(t,"/bulletins/").concat(e,"/users/visits"));return n.when(a).then((function(t){return s.bulletinVisitsStatCache[r]=t,i(t)}),(function(){return i([])}))}i(this.bulletinVisitsStatCache[r])}},{key:"_build_query",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=arguments.length>2?arguments[2]:void 0;return i&&i.length>0?this._post_query(t,e,{user_ids:i.join(",")}):this._query(t,e)}},{key:"_query",value:function(t,e){var i="".concat(this.url,"/api/").concat(t);return e&&this.enableMgsQueryCache&&(i="/anonymous-api/metric-cache/".concat(t)),n.ajax({type:"GET",url:i,dataType:"json"})}},{key:"_post_query",value:function(t,e,i){var s="".concat(this.url,"/api/").concat(t);return n.ajax({type:"POST",url:s,contentType:"application/json; charset=utf-8",data:JSON.stringify(i)})}}])&&v(e.prototype,i),u&&v(e,u),t}();window.statisticsSettings&&(window.stv=new d(window.statisticsSettings))}}]);