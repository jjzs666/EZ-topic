(self.webpackChunklms=self.webpackChunklms||[]).push([[23922],{180736:t=>{t.exports=function(t){return{show:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return e?t.loadingFullPage=!0:t.loading=!0},hide:function(){return t.loadingFullPage=!1,t.loading=!1}}}},665383:(t,e,n)=>{var s=n(963764),i=n(708468),o=n(993776),r=n(904072);function u(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,s)}return n}function a(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?u(Object(n),!0).forEach((function(e){c(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):u(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function c(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t){return function(t){if(Array.isArray(t))return p(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return p(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return p(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function p(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}function h(t,e){for(var n=0;n<e.length;n++){var s=e[n];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}n(382526),n(141817),n(892222),n(126541),n(57327),n(969826),n(489554),n(226699),n(682772),n(821249),n(185827),n(605212),n(702707),n(140561),n(209653),n(556977),n(369070),n(454678),n(324603),n(974916),n(339714),n(115306),n(454747),t.exports=function(){var t=function(){"use strict";function t(e){var n;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),s.extend(this,e),i.has(this,"sub_subjects")||(this.sub_subjects=[]),"matching"!==e.type&&"cloze"!==e.type||(!e.score_rule&&e.settings&&(e.score_rule=e.settings.score_rule),this.score_rule=e.score_rule||"single",this.sub_point="0.0",this.options||(this.options=[])),this.unsavedSubSubjects=s.copy(this.sub_subjects),this.ui={},this.errors={},this.saved=null!==(n=this.saved)&&void 0!==n&&n,this.update()}var e,n,r;return e=t,(n=[{key:"update",value:function(){if("matching"===this.type){var t=this.options,e=(this.saved?this.sub_subjects:this.unsavedSubSubjects).reduce((function(t,e){return[].concat(l(t),[e.options[0]])}),[]);this.matchingSubjectAnswerPool=[].concat(l(e),l(t))}}},{key:"addSubSubject",value:function(e,n){var s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0.0",i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"vertical",o=t.createSubjectByType(e,i);return o.parent_id=this.id,o.point=s,n>=0?this.unsavedSubSubjects.splice(n,0,o):this.unsavedSubSubjects.push(o),o}},{key:"deleteSubSubject",value:function(t){i.remove(this.unsavedSubSubjects,t),t.id?i.remove(this.sub_subjects,{id:t.id}):i.remove(this.sub_subjects,t)}},{key:"addMatchingSubjectInterfereAnswer",value:function(){this.options.push({content:"",is_answer:!1,type:"text",sort:0})}},{key:"deleteMatchingSubjectInterfereAnswer",value:function(t){this.options.splice(t,1)}},{key:"setOptionAsAnswer",value:function(t){return i.forEach(this.options,(function(t){return t.is_answer=!1,!0})),t.is_answer=!0}},{key:"compactSort",value:function(){return i.each(this.options,(function(t,e){return t.sort=e}))}},{key:"addOption",value:function(t){return this.options.push(t)}},{key:"copyOption",value:function(t){var e=s.copy(t);return e.hasOwnProperty("id")&&delete e.id,e.hasOwnProperty("sort")&&(e.sort=i.max(this.options,"sort").sort+1),e.is_answer&&(e.is_answer=!1),e.content="",this.addOption(e)}},{key:"deleteOption",value:function(t){if(i.remove(this.options,t),this.options.length>0&&this.options[0].hasOwnProperty("sort"))return this.compactSort()}},{key:"convertValue",value:function(t){return isNaN(t)||""===t||null===t?t:parseFloat(t)}},{key:"getScore",value:function(){var t=String(this.score),e=t.indexOf(".")+1,n=t.length-e;return e>0&&n>1?parseFloat(this.score).toFixed(1):"0"===t.charAt(t.length-1)?parseFloat(this.score).toFixed(0):this.score}},{key:"getPoint",value:function(){var t=this.convertValue(this.point);if("analysis"!==this.type)return t;var e=[];i(this.sub_subjects).map((function(t){if(""!==t.point)return e.push(t.point)}));var n=i.reduce(e,(function(t,e){return t.plus(new o(e))}),new o(0));return parseFloat(n.toFixed(1))}},{key:"isCompleted",value:function(){var t=!1;return"single_selection"!==this.type&&"true_or_false"!==this.type||(t=!!this.answeredOption),"multiple_selection"===this.type&&(t=i.some(this.options,(function(t){return i.has(t,"checked")&&!0===t.checked}))),"fill_in_blank"===this.type&&(t=!i.any(this.answers,(function(t){return""===t.content}))),"short_answer"===this.type&&(t=Boolean(this.answered_content&&this.answered_content.length>0||this.attachments&&this.attachments.length>0)),"matching"===this.type&&(t=!i.some(this.sub_subjects,(function(t){return 0===t.answer_number}))),["cloze","analysis"].includes(this.type)&&(t=i.every(this.sub_subjects,(function(t){return t.isCompleted()}))),t}},{key:"collectAnswerData",value:function(){var t;if("text"!==this.type)return["matching","cloze","analysis"].includes(this.type)?i.map(this.sub_subjects,(function(t){return t.collectAnswerData()})):"single_selection"===this.type||"true_or_false"===this.type?(t={subject_id:this.id,subject_updated_at:this.last_updated_at},this.answeredOption?t.answer_option_ids=[+this.answeredOption]:t.answer_option_ids=[],t):"multiple_selection"===this.type?{answer_option_ids:i.map(i.filter(this.options,"checked"),"id"),subject_id:this.id}:"short_answer"===this.type?{answer:this.answered_content,subject_id:this.id,attachments:this.attachments}:"fill_in_blank"===this.type?{answers:this.answers,subject_id:this.id}:void 0}},{key:"copy",value:function(){var t=s.copy(this);return t.saved=!1,delete t.id,t}},{key:"isObjective",value:function(){return["single_selection","multiple_selection","true_or_false"].includes(this.type)}},{key:"isSubjective",value:function(){return"short_answer"===this.type}},{key:"hasSubSubjects",value:function(){return["analysis","cloze"].includes(this.type)}},{key:"collectRequestData",value:function(){var t=i.pick(this,["id","last_updated_at","parent_id","description","type","answer_explanation","wrong_explanation","sort","point","difficulty_level","set_limit","character_limit","required","options","options_layout","option_type","correct_answers","has_audio","play_limit","play_limit_times","uploads","note","show_note","score_rule","case_sensitive","unordered","limit_type","point_rule","point_rule_minimum_count"]);return(["text","analysis"].includes(t.type)||0===t.point)&&(t.point="0"),t}},{key:"collectSubSubjectData",value:function(t){var e=this;return["matching","cloze"].includes(this.type)?(0===e.unsavedSubSubjects.length?this.sub_subjects:this.unsavedSubSubjects).map((function(n,s){var i=a(a({},n.collectRequestData()),{},{sort:s,options_layout:e.options_layout});return t&&(i.classification_id=t),"cloze"===e.type&&(i.description="Cloze Subject"),i})):[]}},{key:"updateSubSubjectsPointByRule",value:function(t){var e=this.type;"random"===this.type&&(e="analysis"===this.limit_type?"analysis":"random:".concat(this.limit_type)),"analysis"!==this.type&&(this.point=parseFloat(t[e])),["analysis","random"].includes(this.type)&&("analysis"===this.type?(i.map(this.sub_subjects,(function(e){e.point=parseFloat(t[e.type])})),i.map(this.unsavedSubSubjects,(function(e){e.point=parseFloat(t[e.type])}))):"analysis"!==this.limit_type&&(i.map(this.sub_subjects,(function(n){n.point=parseFloat(t[e])})),i.map(this.unsavedSubSubjects,(function(n){n.point=parseFloat(t[e])}))))}},{key:"deactivateSubject",value:function(){return this.active=!1,i.each(this.unsavedSubSubjects,(function(t){return t.active=!1,!0}))}},{key:"getCorrectOptions",value:function(){var t=[],e=function(e,n){e.is_answer&&t.push(n)},n=function(t){t.forEach(e)};return["matching","cloze"].includes(this.type)?this.sub_subjects.forEach((function(t){n(t.options)})):n(this.options),t}},{key:"isActive",value:function(){return this.active||i.some(this.unsavedSubSubjects,{active:!0})}},{key:"hasError",value:function(t){return this.errors[t]}},{key:"validate",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return"optionsLength"===t?this._setError(t,this.options.length<2):this._setError(t,e)}},{key:"_setError",value:function(t,e){return this.errors[t]=Boolean(e)}}])&&h(e.prototype,n),r&&h(e,r),t}();return t.createSubjectByType=function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"vertical",s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"true",i={type:e,saved:!1};if(i.difficulty_level="analysis"===i.type||"false"===s?"none":"medium",i.play_limit=!0,i.play_limit_times=1,["single_selection","multiple_selection","true_or_false"].includes(i.type)&&(i.options=[{content:"",is_answer:!1,type:"text",sort:0},{content:"",is_answer:!1,type:"text",sort:1}],["single_selection","multiple_selection"].includes(i.type)&&(i.options.push({content:"",is_answer:!1,type:"text",sort:2}),i.options.push({content:"",is_answer:!1,type:"text",sort:3})),i.options_layout=n,i.option_type="text"),"matching"===i.type){i.options_layout=n,i.option_type="text",i.sort=0;for(var o=new t(i),r=0;r<4;r++)o.addSubSubject("single_selection",r);return o.sub_subjects.forEach((function(t){t.options.forEach()})),o}return"cloze"===i.type&&(i.options_layout=n,i.option_type="text"),"fill_in_blank"===i.type&&(i.case_sensitive=!1,i.unordered=!1),new t(i)},t.setSettings=function(t){if(t.settings)return t.point_rule=t.settings.point_rule,t.point_rule_minimum_count=t.settings.point_rule_minimum_count||1,t.options_layout=t.settings.options_layout,t.character_limit=t.settings.character_limit,t.set_limit=t.settings.set_limit,t.required=t.settings.required,t.play_limit=null==t.settings.play_limit||t.settings.play_limit,t.play_limit_times=null==t.settings.play_limit_times?1:t.settings.play_limit_times,t.uploads=t.settings.uploads,t.has_audio=null!=i.find(t.settings.uploads,{type:"audio"})||t.settings.hasOwnProperty("has_audio"),t.show_note=t.settings.show_note,"matching"===t.type?t.score_rule=t.settings.score_rule:"fill_in_blank"===t.type?(t.case_sensitive=t.settings.case_sensitive,t.unordered=t.settings.unordered):"random"===t.type&&(t.limit_type=t.settings.limit_type,t.pointRules=t.settings.point_rules),["single_selection","multiple_selection","true_or_false","matching","cloze"].includes(t.type)?t.option_type=t.settings.option_type||"text":delete t.options},t.createSubjectBySavedSubject=function(e){var n,s=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];s&&(t.setSettings(e),delete e.settings,e.options&&(e.options=i.sortBy(e.options,"sort"))),e.description=e.description.replace(/&nbsp;/g," ");var o=new RegExp("<[^>]+>"),u=[];try{u=o.test(e.description)?r(e.description).find("span.__blank__").get():[]}catch(t){u=[]}var a=u.map((function(t){return{ele:t,uuid:t.getAttribute("data-id")?Number(t.getAttribute("data-id")):0}})),c=i.map(e.sub_subjects,(function(n,o){var r;(n=t.createSubjectBySavedSubject(n,s),u.length>0)&&(n.uuid=null===(r=a[o])||void 0===r?void 0:r.uuid);return"random"===e.type&&(n.ui.showContent=!1,n.isInRandom=!0,n.parent_id=e.id,"analysis"===n.type&&(i.each(n.sub_subjects,(function(t){t.isInRandom=!0,t.isInRandomAnalysis=!0})),i.each(n.unsavedSubSubjects,(function(t){t.isInRandom=!0,t.isInRandomAnalysis=!0})))),n}));if("cloze"===e.type&&c.sort((function(t,e){return t.sort-e.sort})),e.sub_subjects=c,"fill_in_blank"===e.type){if(i.isEmpty(e.answers)||e.answers.length!==e.answer_number){e.answers=[];for(var l=0,p=e.answer_number-1,h=p>=0;h?l<=p:l>=p;h?l++:l--)e.answers.push({sort:l,content:""})}e.displayedDescription=e.description.replace(/_{2,}/gi,"______")}return"short_answer"!==e.type&&"short_answer"!=(null===(n=e.settings)||void 0===n?void 0:n.limit_type)||(""===e.lowest_score&&(e.lowest_score=e.highest_score=e.average_score="-"),e.attachments||(e.attachments=[])),e.saved=!0,new t(e)},t}}}]);